# Housing-Market Quantities: First-Stage Objects

This folder contains intermediate, analysis-ready objects used for the Chapter 2 main
empirical results on housing-market activity and the lock-in channel.

All files are generated by:
- `code/ch02/06_housing_quant/01_first_stage_rategap_hat.R`

Key identifiers:
- `cbsa_code` (5-digit CBSA)
- `ym` (YYYY-MM)

---

## Panel_rategap_hat.csv

**Purpose**  
Create the CBSA-by-month estimation panel used in the **first-stage** regression that
relates the observed mortgage rate gap to the Bartik instrument and controls.

**Inputs**
- Rate gap: `data/transformed/ch02/rate_gap/Rate_gap_monthly.csv`
- Bartik IV: `data/transformed/ch02/iv/SS_IV.csv` (uses `Z_bartik_level` by default)
- Controls:
  - `laus_unemployment_msa.csv`
  - `cbsa_migration_monthly.csv`
  - `bps_cbsa_monthly.csv`
  (all under `data/transformed/ch02/control_variables/`)

**Specification (first stage)**  
`rate_gap ~ Z_bartik + unemployment_rate + mig_rate_month + bps_total`
with CBSA and month fixed effects, and standard errors clustered by CBSA.

**Key columns**
- `rate_gap` : observed mortgage rate gap (percentage points)
- `Z_bartik` : Bartik instrument (Exposure × NatShock)
- `unemployment_rate`, `mig_rate_month`, `bps_total` : controls
- `rategap_hat` : fitted value from the first-stage FE regression
- `rategap_resid` : first-stage residual (diagnostic)

**Time coverage**
- **August 2018 – July 2024** (monthly)

---

## Rategap_hat_singleIV.csv

**Purpose**  
Provide the fitted (instrumented) rate gap series used as the endogenous regressor input
in downstream IV specifications (e.g., 2SLS outcome regressions and LP-IV).

**Columns**
- `cbsa_code`
- `ym`
- `rategap_hat`

**Time coverage**
- **August 2018 – July 2024** (monthly)

## Notes

- These outputs are upstream of the final outcome panel that merges Zillow housing-market
  indicators. They are designed to merge cleanly on (`cbsa_code`, `ym`).
- The first-stage residual is included in **`panel_rategap_hat.csv`** for diagnostics and robustness checks.

---

## LP-IV: Dynamic Response of New Listings to Mortgage Rate Gap

**Purpose**  
Estimate local-projection IV (LP-IV) impulse responses of Zillow new listings to
a mortgage rate gap shock. For each horizon \(h=1,\dots,12\), the regression relates
future new listings to the instrumented rate gap at time \(t\), controlling for CBSA
and month fixed effects.

**Script**  
- `thesis/code/ch02/06_housing_quant/04_lp_iv_new_listings.R`

### Inputs

1) **Rate gap panel with Bartik instrument (CBSA-by-month)**  
- `thesis/data/transformed/ch02/rate_gap/panel_rategap_hat.csv`  
  Required columns: `cbsa_code`, `ym`, `rate_gap`, `Z_bartik`.

2) **Zillow new listings proxy (CBSA-by-month)**  
- `thesis/data/transformed/ch02/zillow/zillow_newlisting.csv`  
  Required columns: `cbsa_code`, `yearmon`, `proxy_value`.

### Outputs

- `thesis/data/output/ch02/housing_quant/lp_iv_new_listings_irf.csv`  
  Contains `horizon`, `beta`, `se`, `N`, and 95% CI bounds for each horizon.

- `thesis/data/output/ch02/housing_quant/lp_iv_new_listings_irf.png`  
  IRF plot with 95% confidence bands.

### Notes
- Each horizon regression includes CBSA and month fixed effects.
- Standard errors are clustered at the CBSA level.
- Horizons use forward leads of the new listings series within each CBSA.
- 
